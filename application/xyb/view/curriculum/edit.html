{include file="Public/head"/}
<body class="no-skin">
{include file="Public/header"/}
<div class="main-container" id="main-container">
    <script type="text/javascript">
        try {
            ace.settings.check('main-container', 'fixed')
        } catch (e) {
        }
    </script>
    {include file="Public/sidebar"/}
    <div class="main-content">
        <div class="main-content-inner">
            <!-- #section:basics/content.breadcrumbs -->
            {include file="Public/breadcrumbs" /}

            <!-- /section:basics/content.breadcrumbs -->
            <div class="page-content">

                {include file="Public/set"/}

                <!-- /section:settings.box -->
                <div class="row">
                    <div class="col-xs-12">
                        <!-- PAGE CONTENT BEGINS -->
                        <div class="row">
                            <div class="col-xs-12">
                                <div class="tabbable">
                                    <ul class="nav nav-tabs">
                                        <li class="active"><a >编辑课程</a></li>
                                    </ul>
                                    <div style="margin-top: 20px;"></div>
                                    <form class="form-horizontal margin-top-20" action="<{:url('Curriculum/edit_post',['tag_id'=>$tag_id])}>" method="post" onsubmit="return check()" enctype="multipart/form-data">
                                        <div class="form-group">
                                            <label for="input-name" class="col-sm-2 control-label"><span style="color: red">*</span>课程分类</label>
                                            <div class="col-md-6 col-sm-10">
                                                <select name="p_id" id="p_id">
                                                    <option value="0">请选择大类</option>
                                                    <{volist name="cat" id="v"}>
                                                    <option value="<{$v.id}>" {if condition="$info.p_id eq $v.id"}selected="selected"{/if}><{$v.name}></option>
                                                    <{/volist}>
                                                </select>
                                                <select name="p_next_id" id="p_next_id">
                                                    <option>请选择二级分类</option>
                                                    <{volist name="cat_next" id="vs"}>
                                                    <option value="<{$vs.id}>" {if condition="$info.p_next_id eq $vs.id"}selected="selected"{/if}><{$vs.name}></option>
                                                    <{/volist}>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="input-name" class="col-sm-2 control-label"><span style="color: red">*</span>课程名称</label>
                                            <div class="col-md-6 col-sm-10">
                                                <input type="text" class="form-control" id="input-name" name="curriculum_name" value="<{$info.curriculum_name}>">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="input-name" class="col-sm-2 control-label"><span style="color: red">*</span>课程简介</label>
                                            <div class="col-md-6 col-sm-10">
                                                <textarea type="text" class="form-control" id="input-name" name="curriculum_intro" rows="8"><{$info.curriculum_intro}></textarea>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="input-name" class="col-sm-2 control-label"><span style="color: red">*</span>课程分数</label>
                                            <div class="col-md-6 col-sm-10">
                                                <input type="text" class="form-control" id="input-name" name="curriculum_score" value="<{$info.curriculum_score}>">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="input-name" class="col-sm-2 control-label"><span style="color: red">*</span>课程学习时间(分钟)</label>
                                            <div class="col-md-6 col-sm-10">
                                                <input type="text" class="form-control" id="input-name" name="curriculum_min" value="<{$info.curriculum_min}>">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="input-name" class="col-sm-2 control-label"><span style="color: red">*</span>图片简介</label>
                                            <div class="col-md-6 col-sm-10">
                                                <img src="__UPLOAD__<{$info.pic}>" style="width: 200px; height: 200px;" id="imgs"/>
                                                <input type="file" name="pic" class="form-control" style="border: none" id="pic" />
                                            </div>
                                        </div>
                                        <input type="hidden" name="kid" value="<{$kid}>"/>
                                        <div class="form-group">
                                            <div class="col-sm-offset-2 col-sm-10">
                                                <button type="submit" class="btn-add">修改</button>
                                                <button type="submit" class="btn-add">取消</button>
                                            </div>
                                        </div>
                                    </form>

                                    <!-- /.tab-content -->
                                </div><!-- /.tabbable -->
                            </div><!-- /.col -->
                        </div><!-- /.row -->

                        <!-- PAGE CONTENT ENDS -->
                    </div><!-- /.col -->
                </div><!-- /.row -->
            </div><!-- /.page-content -->
        </div>
    </div><!-- /.main-content -->

    {include file="Public/footer"/}

</div><!-- /.main-container -->

{include file="Public/footerjs"/}
<!-- inline scripts related to this page -->
</body>
</html>
<script type="application/javascript">
    function check(){
        var p_id=$("#p_id").val();
        var p_next_id=$("#p_next_id").val();
        var curriculum_name=$("input[name=curriculum_name]").val();
        var curriculum_intro=$("input[name=curriculum_intro]").val();
        var curriculum_score=$("input[name=curriculum_score]").val();
        var curriculum_min=$("input[name=curriculum_min]").val();
        var pic=$('#pic').get(0).files[0];
        if(p_id==0){
            layer.msg('请选择大类', {
                icon: 0,
                time: 2000 ,//2秒关闭（如果不配置，默认是3秒）
                anim: 6
            });
            return false;
        }
        if(p_next_id==0){
            layer.msg('请选择二级分类', {
                icon: 0,
                time: 2000 ,//2秒关闭（如果不配置，默认是3秒）
                anim: 6
            });
            return false;
        }
        if(curriculum_name==''){
            layer.msg('请填写课程名称', {
                icon: 0,
                time: 2000 ,//2秒关闭（如果不配置，默认是3秒）
                anim: 6
            });
            return false;
        }
        if(curriculum_intro==''){
            layer.msg('请填写课程简介', {
                icon: 0,
                time: 2000 ,//2秒关闭（如果不配置，默认是3秒）
                anim: 6
            });
            return false;
        }
        if(curriculum_score==''){
            layer.msg('请填写课程分数', {
                icon: 0,
                time: 2000 ,//2秒关闭（如果不配置，默认是3秒）
                anim: 6
            });
            return false;
        }
        if(curriculum_min==''){
            layer.msg('请填写课程分钟数', {
                icon: 0,
                time: 2000 ,//2秒关闭（如果不配置，默认是3秒）
                anim: 6
            });
            return false;
        }
        if(pic==''){
            layer.msg('请选择图片', {
                icon: 0,
                time: 2000 ,//2秒关闭（如果不配置，默认是3秒）
                anim: 6
            });
            return false;
        }
        $('.btn-add').attr('disabled',true);
    }
    //获取图片路劲的方法，兼容多种浏览器，通过createObjectURL实现
    function getObjectURL(file){
        var url = null;
        if(window.createObjectURL != undefined){
            url = window.createObjectURL(file);//basic
        }else if(window.URL != undefined){
            url = window.URL.createObjectURL(file);
        }else if(window.webkitURL != undefined){
            url = window.webkitURL.createObjectURL(file);
        }

        return url;
    }

    //实现功能代码
    $("input[type=file]").change(function(){
        var path = $("input[type=file]").value;
        var objUrl = getObjectURL(this.files[0]);
        if(objUrl){
            $('#imgs').attr("src",objUrl);
        }
    })
    //切换分类
    $("#p_id").change(function(){
        var p_id=$("#p_id").val();
        if(p_id>0){
            var p_next_id=$("#p_next_id").empty();
            var str='';
            $.post('__URL__curriculum/get_cat',{p_id:p_id},function(data){
                if(data){
                    for(var i=0;i<data.info.length;i++){
                        str+="<option value='"+data.info[i].id+"'>'"+data.info[i].name+"'</option>";
                    }
                    $("#p_next_id").append(str);
                }
            })
        }else{
            $("#p_next_id").empty();
            $("#p_next_id").append('<option value="0">请选择二级分类</option>');
        }
    })
</script>
